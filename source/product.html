<section class="product_images section productSection">

  <div class="productImagesContainer ">
    {% for image in product.images %}
      <div class="productImagePlaceholder">
        <img
          class="lazy primary_image "
          src="{{ image | product_image_url }}"
          loading="lazy"
          alt="Image of {{ product.name | escape }}">
      </div>
    {% endfor %}
  </div>

  <aside class="productPanel boxBorder">

    <div class="productContent">
      <div class="productInfos">
        <div class="productRoutingContainer">
        {% assign categories = product.categories %}
          <!-- Assuming 'product.categories' is your array of CategoryDrop objects -->
          {% assign category_to_display = nil %}

          {% for category in categories %}
            {% if category.name != "featured" %}
              {% assign category_to_display = category %}
              {% break %}
              <!-- This stops the loop after finding the first non-featured category -->
            {% endif %}
          {% endfor %}

          {% if category_to_display != nil %}
            <a href="/products" id="product-link">Shop</a>
            <span>/</span>
            <a href="/category/{{ category_to_display.name | downcase | url_encode }}" id="category-link">
              {{ category_to_display.name | downcase }}
            </a>

          <!-- Outputs the name of the first non-featured category in lowercase -->
          {% else %}
            _
          {% endif %}
        </div>

        <h2>{{ product.name }}</h2>

        <div class="productDefaultPrice textLarge">
          {% case product.status %}
            {% when 'sold-out' %}
              <h5>{{ product.default_price | money_with_sign }}
                <em>Sold Out</em>
              </h5>

            {% when 'coming-soon' %}
              <h5>
                {{ product.default_price | money_with_sign }}
                <em>Coming Soon</em>
              </h5>

            {% when 'active' %}
              <h5>
                {{ product.default_price | money_with_sign }}
                {% if product.on_sale %}
                  <em>On Sale</em>
                {% endif %}
              </h5>
            </div>
            {% if product.description != blank %}
              <div class="productDescription">
                {{ product.description | paragraphs }}
              </div>
            {% endif %}
        {% endcase %}
      </div>

      <form
        method="post"
        action="/cart"
        class="productForm">
        {% if product.has_default_option %}
          {{ product.option | hidden_option_input }} {% else %}
          <div class="productFormSelect">{{ product.options_in_stock | options_select }}</div>
        {% endif %}
        <button
          name="submit"
          type="submit"
          title="Add to Cart"
          class="boxBorder">
          Add to Cart {% include 'arrow-icon' %}
        </button>
      </form>
    </div>


  </aside>
</section>