<section class="product_images section productSection">
  <div class="productImagesContainer">
    {% for image in product.images %}
    <div class="productImagePlaceholder">
      <img
        class="lazy primary_image"
        src="{{ image | product_image_url }}"
        loading="lazy"
        alt="Image of {{ product.name | escape }}"
      />
    </div>
    {% endfor %}
  </div>

  <aside class="productPanel boxBorder">
    <div class="productContent">
      <div class="productInfos">
        <div class="productRoutingContainer">
          {% assign categories = product.categories %}
          <!-- Assuming 'product.categories' is your array of CategoryDrop objects -->
          {% assign category_to_display = nil %} {% for category in categories
          %} {% if category.name != "featured" %} {% assign category_to_display
          = category %} {% break %}
          <!-- This stops the loop after finding the first non-featured category -->
          {% endif %} {% endfor %} {% if category_to_display != nil %}
          <a href="/products" id="product-link" class="productLink">Shop</a>
          <span class="productLink">/</span>
          <a
            href="/category/{{ category_to_display.name | downcase | url_encode }}"
            id="category-link"
            class="productLink"
          >
            {{ category_to_display.name | downcase }}
          </a>

          <!-- Outputs the name of the first non-featured category in lowercase -->
          {% else %} _ {% endif %}
        </div>

        <h2>{{ product.name }}</h2>

        <div class="productDefaultPrice textLarge">
          {% case product.status %} {% when 'sold-out' %}
          <h5>
            {{ product.default_price | money_with_sign }}
            <em>Sold Out</em>
          </h5>

          {% when 'coming-soon' %}
          <h5>
            {{ product.default_price | money_with_sign }}
            <em>Coming Soon</em>
          </h5>

          {% when 'active' %}
          <h5>
            {{ product.default_price | money_with_sign }} {% if product.on_sale
            %}
            <em>On Sale</em>
            {% endif %}
          </h5>
        </div>
        {% if product.description != blank %}
        <div class="productDescription">
          <span class="productDescriptionTrigger">Description</span>
          <div class="productDescriptionContainer">
            <div class="productDescriptionContent">
              {{ product.description | paragraphs }}
            </div>
          </div>
        </div>
        {% endif %} {% endcase %}
      </div>

      <form method="post" action="/cart" class="productForm">
        {% if product.has_default_option %} {{ product.option |
        hidden_option_input }} {% else %}
        <div class="productFormSelect">
          {{ product.options_in_stock | options_select }}
          <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
            <g>
              <line class="cls-1" x1="16" x2="7" y1="20.5" y2="11.5" />
              <line class="cls-1" x1="25" x2="16" y1="11.5" y2="20.5" />
            </g>
          </svg>
        </div>
        {% endif %}
        <button
          name="submit"
          type="submit"
          title="Add to Cart"
          class="boxBorder"
        >
          Add to Cart {% include 'arrow-icon' %}
        </button>
      </form>
    </div>
  </aside>
</section>
